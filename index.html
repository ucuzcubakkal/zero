<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zero – Eco Lifestyle Coach</title>
<meta name="description" content="Zero helps you track your carbon footprint, get personalized eco tips, and monitor progress — in any language, anywhere.">
<style>
  :root{ --bg:#0b1e18; --card:#123126; --muted:#b6d5ca; --accent:#7be495; --text:#ffffff; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
  .wrap{max-width:1000px;margin:0 auto;padding:20px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,#2fbf71,#0ea371)}
  .lang{display:flex;gap:8px}
  button, a.btn{border:0;border-radius:10px;padding:10px 14px;cursor:pointer;background:var(--accent);color:#0b1e18;font-weight:600;text-decoration:none}
  button.ghost{background:transparent;color:var(--muted);border:1px solid #26453b}
  .card{background:color-mix(in srgb, var(--card) 90%, transparent);border:1px solid #1f3c31;border-radius:16px;padding:20px;margin-top:16px}
  h1{margin:14px 0 6px}
  p.lead{margin:0;color:var(--muted)}
  .grid{display:grid;gap:14px}
  @media(min-width:1050px){ .grid{grid-template-columns:1.1fr .9fr} }
  .muted{color:var(--muted)}
  footer{margin:30px 0 10px;color:var(--muted);font-size:14px;display:flex;gap:12px;flex-wrap:wrap}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{border:1px solid #2b5144;color:var(--muted);padding:6px 10px;border-radius:999px;font-size:13px}
  .badge{display:inline-block;background:#0f342a;border:1px solid #2a5c4b;border-radius:8px;padding:6px 10px;font-size:13px;color:var(--muted)}
  .tip{border-left:3px solid var(--accent);padding-left:10px}
  .links{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .kpi{display:flex;gap:14px;flex-wrap:wrap}
  .kpi .box{flex:1 1 180px;border:1px solid #1f3c31;background:#0d261f;border-radius:12px;padding:12px}
  .center{display:flex;align-items:center;gap:10px}
  .sponsors{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
  .sp{border:1px solid #1f3c31;background:#0d261f;border-radius:12px;padding:12px;display:flex;gap:10px;align-items:center}
  .sp img{width:46px;height:46px;object-fit:contain;background:#062018;border-radius:10px;border:1px solid #15392e}
  .err{background:#3a1414;border:1px solid #6a2a2a;color:#f5d0d0;padding:10px;border-radius:8px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div style="font-weight:700">Zero – Eco Lifestyle Coach</div>
          <div class="muted" data-i18n="subtitle">Track Your Eco Impact</div>
        </div>
      </div>
      <div class="lang">
        <button class="ghost" onclick="manualLang('en')">English</button>
        <button class="ghost" onclick="manualLang('tr')">Türkçe</button>
        <button class="ghost" onclick="manualLang('de')">Deutsch</button>
        <button class="ghost" onclick="manualLang('ar')">العربية</button>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h1 data-i18n="welcome">Welcome to Zero</h1>
        <p class="lead" data-i18n="desc">Calculate your carbon footprint, get personalized eco tips, and track your progress — in any language, anywhere.</p>

        <div class="kpi" style="margin-top:12px">
          <div class="box">
            <div class="muted" data-i18n="kpi1t">Current Impact</div>
            <div style="font-size:22px;font-weight:700">—</div>
            <div class="muted" data-i18n="kpi1d">Starter mode (no payments)</div>
          </div>
          <div class="box">
            <div class="muted" data-i18n="kpi2t">This Month</div>
            <div style="font-size:22px;font-weight:700">—</div>
            <div class="muted" data-i18n="kpi2d">Track tips completed</div>
          </div>
          <div class="box">
            <div class="muted" data-i18n="kpi3t">Badges</div>
            <div class="chips"><span class="chip">Starter</span><span class="chip">Ad-Free Tips</span></div>
          </div>
        </div>

        <div class="links">
          <a class="btn" href="/health.html" data-i18n="health">Health Check</a>
          <a class="btn" href="#tips" data-i18n="tipsBtn">Eco Tips</a>
          <a class="btn" href="#reports" data-i18n="reportBtn">Monthly Report</a>
        </div>
      </section>

      <aside class="card" id="tips">
        <div class="center" style="justify-content:space-between">
          <h3 style="margin:0" data-i18n="tipsTitle">Quick Eco Tips</h3>
          <span class="badge" id="savedBadge">Saved: 0</span>
        </div>
        <div id="tipsList" style="margin-top:10px;display:grid;gap:10px"></div>
        <div id="tipsErr" style="margin-top:10px;display:none" class="err"></div>
      </aside>
    </div>

    <section class="card">
      <div class="center" style="justify-content:space-between">
        <h3 style="margin:0" data-i18n="spTitle">Sponsors</h3>
        <a class="ghost" href="/admin.html" data-i18n="adminLink">Admin</a>
      </div>
      <div id="spGrid" class="sponsors" style="margin-top:10px"></div>
      <div id="spErr" style="margin-top:10px;display:none" class="err"></div>
    </section>

    <section class="card" id="reports" style="margin-top:16px">
      <h3 style="margin:0 0 6px" data-i18n="reportTitle">Monthly Progress</h3>
      <p class="muted" data-i18n="reportDesc">Save tips as you complete them; your monthly progress will appear here.</p>
      <div class="chips" id="monthChips">
        <span class="chip"><span data-i18n="tipsCompleted">Tips completed</span>: <b id="doneCount">0</b></span>
        <span class="chip" data-i18n="langsInfo">Languages: EN / TR / DE / AR</span>
        <span class="chip" data-i18n="paymentsInfo">Payments: Disabled</span>
      </div>
    </section>

    <footer>
      <a class="ghost" href="/privacy.html" data-i18n="privacy">Privacy</a>
      <a class="ghost" href="/terms.html" data-i18n="terms">Terms</a>
      <span>© <span id="year"></span> Zero</span>
    </footer>
  </div>

  <!-- i18next + backend + detector (CDN) -->
  <script src="https://unpkg.com/i18next@23.10.1/dist/umd/i18next.min.js"></script>
  <script src="https://unpkg.com/i18next-http-backend@2.4.3/i18nextHttpBackend.min.js"></script>
  <script src="https://unpkg.com/i18next-browser-languagedetector@7.1.0/i18nextBrowserLanguageDetector.min.js"></script>

  <script>
    // Ülkeye göre dil zorlaması (opsiyonel). İstersen açık bırak:
    const countryToLang = { TR:'tr', DE:'de', AT:'de', CH:'de', AE:'ar', SA:'ar', QA:'ar', KW:'ar' };
    async function detectCountryLang(){
      try{
        const r = await fetch('https://ipapi.co/json/'); // opsiyonel: ülke tespiti
        if(!r.ok) return null;
        const j = await r.json();
        return countryToLang[j.country_code] || null;
      }catch(_){ return null; }
    }

    function applyI18n(){
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const k = el.getAttribute('data-i18n');
        el.textContent = i18next.t(k);
      });
      // rozet & sayaç
      const savedNow = parseInt(localStorage.getItem('zero_saved_count')||'0',10);
      document.getElementById('savedBadge').textContent = i18next.t('saved') + ': ' + savedNow;
      document.getElementById('doneCount').textContent = savedNow;
      document.getElementById('year').textContent = new Date().getFullYear();
      // listeler
      loadTipsCSV();
      loadSponsors();
    }

    function manualLang(lng){
      localStorage.setItem('lang', lng);
      i18next.changeLanguage(lng).then(applyI18n);
    }

    // i18n init
    (async function initI18n(){
      let forced = localStorage.getItem('lang');
      if(!forced){
        // önce tarayıcı dili, sonra ülke bazlı zorunlu dil
        const countryLang = await detectCountryLang(); // istersen kapat
        if(countryLang) localStorage.setItem('lang', countryLang);
      }
      i18next
        .use(i18nextHttpBackend)
        .use(i18nextBrowserLanguageDetector)
        .init({
          fallbackLng: 'en',
          supportedLngs: ['en','tr','de','ar'],
          backend: { loadPath: '/i18n/{{lng}}.json' },
          detection: {
            order: ['localStorage','navigator','htmlTag'],
            caches: ['localStorage']
          }
        }).then(applyI18n);
    })();

    function saveTip(){
      const k='zero_saved_count';
      const n=parseInt(localStorage.getItem(k)||'0',10)+1;
      localStorage.setItem(k,String(n));
      document.getElementById('savedBadge').textContent = i18next.t('saved')+': '+n;
      document.getElementById('doneCount').textContent = n;
    }

    async function loadTipsCSV(){
      const list = document.getElementById('tipsList'); list.innerHTML='';
      const err = document.getElementById('tipsErr'); err.style.display='none';
      const lng = i18next.language?.split('-')[0] || 'en';
      try{
        const res = await fetch('/tips.csv?cache='+Date.now());
        if(!res.ok) throw new Error('HTTP '+res.status);
        const text = await res.text();
        const rows = text.split(/\r?\n/).map(r=>r.trim()).filter(Boolean);
        const items = rows.slice(1).map(r=>{
          const idx = r.indexOf(','); if(idx<0) return null;
          const l = r.slice(0,idx).trim().toLowerCase();
          const tip = r.slice(idx+1).trim();
          return { lang:l, tip };
        }).filter(Boolean).filter(it => it.lang === lng);
        const fallback = [{tip: i18next.t('tipFallback1')}];
        renderTips(items.length?items:fallback);
      }catch(e){
        err.style.display='block';
        err.textContent = i18next.t('tipsErr');
      }
    }

    function renderTips(items){
      const list = document.getElementById('tipsList'); list.innerHTML='';
      items.forEach((it)=>{
        const row = document.createElement('div');
        row.className='tip';
        row.innerHTML = `<div>${it.tip}</div>
          <div class="links"><button class="ghost" onclick="saveTip()">✓ ${i18next.t('saved')}</button></div>`;
        list.appendChild(row);
      });
    }

    async function loadSponsors(){
      const grid = document.getElementById('spGrid'); grid.innerHTML='';
      const err = document.getElementById('spErr'); err.style.display='none';
      try{
        const res = await fetch('/sponsors.csv?cache='+Date.now());
        if(!res.ok) throw new Error('HTTP '+res.status);
        const text = await res.text();
        const rows = text.split(/\r?\n/).map(r=>r.trim()).filter(Boolean);
        const items = rows.slice(1).map(r=>{
          const cols = r.split(',');
          return { title:(cols[0]||'').trim(), url:(cols[1]||'').trim(), image:(cols[2]||'').trim() };
        }).filter(x=>x.title);
        if(!items.length) throw new Error('empty');
        items.forEach(sp=>{
          const card = document.createElement('a');
          card.className='sp'; card.href = sp.url||'#'; card.target='_blank';
          card.innerHTML = `<img src="${sp.image||''}" alt="">
                            <div><div style="font-weight:700">${sp.title}</div>
                            <div class="muted" style="font-size:13px">${sp.url||''}</div></div>`;
          grid.appendChild(card);
        });
      }catch(e){
        err.style.display='block';
        err.textContent = i18next.t('spErr');
      }
    }
  </script>
</body>
</html>
